<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Provocation Engine</title>
    <style>
        :root {
            --main-bg: #1d1212;
            --text-color: #111;
            --border-color: #111;
            --button-bg-hover: #111;
            --button-text-hover: #f5f5f5;
            --box-bg: #fff; /* This is our "off-white" */
        }

        body {
            font-family: 'Courier New', Courier, monospace;
            background-color: var(--main-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 2rem;
            box-sizing: border-box;
            text-align: center;
        }

        main {
            width: 100%;
            max-width: 600px;
        }

        #provocation-container {
            min-height: 250px;
            border: 1px solid var(--border-color);
            /* --- CHANGE 1: Increased horizontal padding for better visual balance --- */
            padding: 2rem 3rem;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-bottom: 2rem;
            background-color: var(--box-bg);
        }
        
        #provocation-text {
            font-size: 1.2rem;
            line-height: 1.7;
            text-align: left;
            /* Ensures the container spans the full width of the padding box */
            width: 100%;
        }

        .task-separator {
            display: block;
            /* --- CHANGE 2: Left-aligned the separator and adjusted margins for a poetic feel --- */
            text-align: left;
            /* Creates a longer pause after the setup, and a shorter link to the task */
            margin: 2.5rem 0 1rem 0;
        }
        
        #provocation-container.loading #provocation-text,
        #provocation-container.error #provocation-text {
            font-size: 1.1rem;
            text-align: center;
            width: 100%;
        }

        #provocation-container.error #provocation-text {
            color: #d90429;
        }

        button {
            font-family: inherit;
            font-size: 1rem;
            padding: 0.75rem 1.5rem;
            border: 1px solid var(--border-color);
            /* --- CHANGE 3: Set background to match the card, making it visible --- */
            background: var(--box-bg);
            color: var(--text-color);
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            text-transform: uppercase;
        }

        button:hover:not(:disabled),
        button:focus:not(:disabled) {
            background-color: var(--button-bg-hover);
            color: var(--button-text-hover);
            outline: none;
        }
        
        button:active:not(:disabled) {
            transform: translateY(1px);
        }

        button:disabled {
            cursor: not-allowed;
            opacity: 0.5;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 1rem;
            }
            #provocation-container {
                /* Adjusted padding for smaller screens */
                padding: 2rem 1.5rem;
            }
            #provocation-text {
                font-size: 1.1rem;
            }
            button {
                width: 100%;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <main>
        <div id="provocation-container" class="loading">
            <p id="provocation-text">Loading Provocation...</p>
        </div>
        <button id="generate-btn" disabled>Generate New Provocation</button>
    </main>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // --- DOM Elements ---
            const generateBtn = document.getElementById('generate-btn');
            const provocationContainer = document.getElementById('provocation-container');
            const provocationTextEl = document.getElementById('provocation-text');
            
            // --- Global State ---
            let thinkers = [];

            // --- API Configuration ---
            const API_KEY = "AIzaSyDKYB5e-4lHnSEAwsgfXOO7WpqJ0fWUh7A"; // PASTE YOUR GEMINI API KEY HERE
            const API_URL = `https://generativelanguage.googleapis.com/v1beta/models/gemini-1.5-flash:generateContent?key=${API_KEY}`;
            
            // --- Core Functions ---

            /**
             * Fetches and prepares the thinker data from the external JSON file.
             */
            async function initialize() {
                const JSON_URL = 'thinkers.json'; 
                
                try {
                    const response = await fetch(JSON_URL);
                    if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                    const thinkersData = await response.json();
                    
                    preprocessThinkersData(thinkersData); 
                    
                    generateBtn.disabled = false;
                    generateBtn.addEventListener('click', generateProvocation);
                    
                    await generateProvocation();

                } catch (error) {
                    console.error("Initialization Error:", error);
                    provocationContainer.classList.add('error');
                    provocationTextEl.textContent = "Error: Could not load thinkers.json. Please check that the file exists and the path is correct.";
                }
            }

            /**
             * Assigns the fetched data to our global state variable.
             */
            function preprocessThinkersData(data) {
                thinkers = data.thinkers;
            }

            /**
             * The main logic for generating a provocation.
             */
            async function generateProvocation() {
                if (!thinkers || thinkers.length === 0) {
                    provocationTextEl.textContent = "Thinkers not loaded. Please check the console.";
                    console.error("Attempted to generate a provocation before thinkers data was loaded.");
                    return;
                }

                const randomThinker = getRandom(thinkers);
                const spiritInstruction = randomThinker.spirit_instruction;
                const seed = getRandom(randomThinker.seeds);

                const systemPrompt = `You are a generator of small, poetic, and actionable creative provocations. You translate a dense artistic concept into a simple, everyday task. You will return a JSON object with two keys: "setup" and "task".

                // --- PRIMARY DIRECTIVES ---
                **1. The "Anti-Homework" Mandate:** The task must NEVER feel like homework. It must avoid long-form writing or complex research.
                **2. The "Simplicity Filter":** The core task must be a single, elegant action explainable in one sentence.
                **3. The "Artifact Guarantee":** Every task MUST result in a small, simple physical or digital artifact (a photo, a note, a drawing).
                **4. The "Weirdness" Bias:** Favor the slightly strange or subversive option.

                // --- CORE RULES ---
                - The "setup" must be a single, short, poetic sentence.
                - The task must be a physical, tangible action.
                - Forbid abstract tasks like "imagine" or "consider".
                - NEVER mention the original source, person, or use any special jargon.

                **SPECIAL INSTRUCTION FOR THIS GENERATION (The 'Guiding Spirit'):**
                // ${randomThinker.name} //
                ${spiritInstruction}`;
                
                const userPrompt = `Based on the following conceptual seed, generate a creative provocation that follows all the rules, especially the 'Guiding Spirit' instruction. 
                
                CONCEPTUAL SEED: """${seed}"""`;

                await callGemini(systemPrompt, userPrompt);
            }

            /**
             * Handles the API call to Google Gemini.
             */
            async function callGemini(systemPrompt, userPrompt) {
                provocationContainer.classList.remove('error');
                provocationContainer.classList.add('loading');
                provocationTextEl.textContent = 'Generating...';
                
                const payload = {
                    contents: [{ parts: [{ text: userPrompt }] }],
                    generationConfig: {
                        responseMimeType: "application/json",
                        responseSchema: {
                            type: "OBJECT",
                            properties: {
                                "setup": { "type": "STRING" },
                                "task": { "type": "STRING" }
                            },
                            required: ["setup", "task"]
                        }
                    },
                    systemInstruction: { parts: [{ text: systemPrompt }] },
                };

                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        const errorBody = await response.text();
                        throw new Error(`API error: ${response.status} ${errorBody}`);
                    }

                    const result = await response.json();
                    const text = result.candidates?.[0]?.content?.parts?.[0]?.text;
                    
                    if (text) {
                        const parsedJson = JSON.parse(text);
                        renderProvocation(parsedJson);
                    } else {
                        throw new Error("The API returned an empty or invalid response.");
                    }
                } catch (error) {
                    console.error('Gemini API Call Error:', error);
                    provocationTextEl.textContent = "Error generating provocation. Check the console for details.";
                    provocationContainer.classList.add('error');
                } finally {
                    provocationContainer.classList.remove('loading');
                }
            }
            
            // --- Helper & Utility Functions ---

            /**
             * Renders the generated provocation text into the DOM.
             */
            function renderProvocation({ setup, task }) {
                provocationTextEl.innerHTML = `
                    <span class="setup-text">${setup}</span>
                    <span class="task-separator"><u>YOUR TASK</u></span>
                    <span class="task-text">${task}</span>
                `;
            }

            /**
             * A utility function to get a random item from an array.
             */
            const getRandom = (arr) => arr[Math.floor(Math.random() * arr.length)];
            
            // --- Start The Application ---
            initialize();
        });
    </script>
</body>
</html>
